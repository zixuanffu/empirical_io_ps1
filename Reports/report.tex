\documentclass[12pt]{article}
\usepackage{fullpage,graphicx,psfrag,amsmath,amsfonts,verbatim}
\usepackage[small,bf]{caption}
\usepackage{amsthm}
% \usepackage[hidelinks]{hyperref}
\usepackage{hyperref}
\usepackage{bbm} % for the indicator function to look good
\usepackage{color}
\usepackage{mathtools}
\usepackage{fancyhdr} % for the header
\usepackage{booktabs} % for regression table display (toprule, midrule, bottomrule)
\usepackage{adjustbox} % for regression table display
\usepackage{threeparttable} % to use table notes
\usepackage{natbib} % for bibliography
\input newcommand.tex
\bibliographystyle{apalike}
% \setlength{\parindent}{0pt} % remove the automatic indentation

\title{Empirical IO PS1}
\author{Zixuan, Anoosheh, Shuo}
\date{\today}

\begin{document}
\maketitle

\setcounter{page}{1}
\section{Data}
The dataset is a panel of aggregate (model level) car sales along with the
characteristics of each model. The data spans 1977-1981 in the U.S., give rise
to 5 markets in total. We divide the quantity sold \verb|q| by the market size
(the number of households \verb|hh| in that year) to get the market share for
each model. We also adjust the car price \verb|p| by the consumer price index
\verb|cpi| to get the real price.
\begin{equation*}
    p_{adj} = \frac{100 p}{cpi}
\end{equation*}
We rescale the price by $p/1000$ to make the coefficient on price more readable.
An overview of the mean and standard deviation of the variables is shown in Table \ref{tab:desc}.
\input{../Results/Tables/descriptive.tex}

\section{Question 1:Logit}
\subsection{Utility function}
The standard utility function takes the following linear in characteristics
form:
\begin{equation}
    u_{ij}=X_{j}\beta + \alpha p_{j} + \xi_{j}+ \epsilon_{ij}=\delta_j+\epsilon_{ij}
\end{equation}
where $i$ represents individual $j$ product. And $X_{j}$ includes the following variables:\\
\verb|dpm, door3, door4, door5, at, ps, air, drv, wt, hp2wt, hp, euro, japna, size, wb, (brand dummies)|.
We assume that $\epsilon_{ij}$ is distributed type I extreme value, and are independent across all product $j$. Thus, the market share for each product is given by
By normalizing the utility of the outside good to zero, we have
\begin{equation*}
    s_j=\frac{e^{u_{ij}}}{1+\sum_{k=1}^{J}e^{u_{ik}}}
\end{equation*}
Thus,
\begin{equation}\label{eq:logit}
    \log s_j-\log s_0=\beta_0+\beta_1x_{j1}+\cdots+p_j\alpha+\xi_j
\end{equation}
where $\xi_j$ the fixed effect/unobserved heterogeneity of each product $j$.
For the remaining section, we assume that all characteristics except price are exogenous.
\subsection{Estimation}
The OLS estimation is unbiased and consistent if we assume that $\xi_j$ is
uncorrelated with $p$. We perform two ols estimation based on equation
\ref{eq:logit} with and without brand fixed effect. The results are shown in
Table \ref{tab:reg_logit}. However, it is generally not the case. Price is
generally correlated with unobserved characteristics. We construct instruments
based on \citep{blp1995}. That is, for each product characteristics $x^k$, we
compute
\begin{itemize}
    \item $z^k_{j}=\sum_{k\in \mathcal{F}_j, j'\neq j}x^k_{j'}$, the sum of characteristics of all other products belong to the same firm.
    \item $z^k_{j}=\sum_{k\notin \mathcal{F}_j}x^k_{j'}$, the sum of characteristics of all other products belong to the rival firms.
\end{itemize}
Since we have many $x^k$, we have a large number of instruments. Following \citep{blp1995}, we selected the following to instrument price $p$:\\
\verb|const_*, dpm_*, hp2wt_*,size_*, air_*|
The iv estimation results are shown in Table \ref{tab:reg_logit}.
\subsection{Results}
\begin{table}[h!]\fontsize{10pt}{12pt}\selectfont
    \centering
    \input{../Results/Tables/logit.tex}
    \caption{Logit estimation results}
    \label{tab:reg_logit}
\end{table}

\section{Question 2:Nested logit}
\subsection{Utility function}
We relax the assumption that $\varepsilon_{ij}$ are independent across $j$.
Instead, we group the products into nests based on their size. The 3 nests are
\verb|compact, midsize, large| plus one outside option. Now the utility
function is given by
\begin{equation}
    \begin{split}
        u_{ij}&=X_{j}\beta + \alpha p_{j} + \xi_{j}+ \eta_{ig}+ \epsilon_{ij}\\
        &=\delta_j+\eta_{ig}+(1-\sigma)\epsilon_{ij}
    \end{split}
\end{equation}
Now the estimation equation is
\begin{equation}
    \log(s_j)-\log(s_0)=x_j\beta+p_j\alpha+\sigma\log(\bar{s}_{j|g})+\xi_j
\end{equation}
\subsection{Estimation}
In addition to $p$ now $\log(\bar{s}_{j|g})$ is also endogenous. We follow
\citep{berry1994} to construct additional instruments for
$\log(\bar{s}_{j|g})$, which is the sum of product characteristics of the rival
firms in the same nest $g$. The estimation results are shown in Table
\ref{tab:reg_nested_logit}.

\subsection{Results}
\begin{table}[h!]\fontsize{10pt}{12pt}\selectfont
    \centering
    \input{../Results/Tables/nested_logit.tex}
    \caption{Nested Logit estimation results}
    \label{tab:reg_nested_logit}
\end{table}

The F-test of the first stage is commonly named weak instrument test. The null
hypothesis is that the instruments are weak, which is rejected by the test. The
Sargan-Hansen test is a test of over-identification. The null hypothesis is
that all instruments are valid, which is rejected by the test, implying that
some instruments are not suitable.

\paragraph{$\hat{\alpha}$} We see that in both cases, the IV estimation gives a larger estimate of the price coefficient, which indicates that price is positively correlated with the unobserved characteristics. The OLS estimation is upward biased.
\paragraph{$\hat{\sigma}$} The estimate of $\sigma$ is smaller in IV that in OLS,
implying that the group share $\log(\bar{s}_{j|g})$ positively correlates with
$\xi_j$. The OLS estimation is also upward biased.

\section{Question 3}
\subsection{Utility function}
We now consider a random coefficient model. The utility function is given by
\begin{equation}
    u_{ij}=X_{j}\beta + \alpha p_{j} + \xi_{j}+ \eta_i\text{size}_j+ \epsilon_{ij}=\delta_j+\eta_i\text{size}_j+\epsilon_{ij}
\end{equation}
where $eta_i\sim N(0,\sigma^2)$.

\subsection{Estimation}

Unlike before, the relationship between $log(s_j)$ and $\delta_j$ is no longer
as explicit as before ($\delta_j=\log(s_j)-\log(s_0)$). We need to find a way
to recover $\delta_j$ from the observed market share $s_j$. We follow the
method provided by \citep{blp1995}.

The procedure is the following:
\begin{enumerate}
    \item We draw 500 values from a normal distribution $N(0,1)$.
    \item We pick an initial value of $\sigma$.
    \item Given a value of $\sigma$, we calculate the predicted market share based on
          $\sigma$ by approximate the following integral
          \begin{equation*}
              s_j(\delta_1,\ldots,\delta_j)=\int \frac{e^{\delta_j+\eta_i\text{size}_j}}{1+\sum_{k=1}^{J}e^{\delta_k+\eta_i\text{size}_k}}dF(\eta_i)
          \end{equation*}
    \item We use contraction mapping to find the value of $\delta$ vector that makes the
          predicted market share equal to the observed market share.
    \item Once we have the $\delta$ vector which is linear in $X$.
          \begin{equation*}
              \delta_j=X_j\beta+\alpha p_j+\xi_j
          \end{equation*}
          We can estimate the $\beta$ and $\alpha$ with some instruments, thus getting the residual $\xi_j$.
    \item We compute the empirical moment condition is $Q(\sigma)=Z'\xi$ where $Z$ is the
          instruments and $\xi$ is the residual, which is of dimension $ #\text{instr}
              \times 1$. The GMM objective function is thus $Q(\sigma)'WQ(\sigma)$.
          \begin{equation*}
              \min_{\sigma} Q(\sigma)'WQ(\sigma)
          \end{equation*}
\end{enumerate}

Note that by creating nests, we create a new endogenous variable
$\log(\bar{s}_{j|g})$ for which we create new instruments. Similarly, by
creating a random coefficient term $\eta_i$ on size, we create extra
endogeneity. (How so?) We follow \citep{houdeghandi2020} to construct extra
differentiation instrument.
\begin{enumerate}
    \item Quadratic: $\sum_{j' \neq j} (d_{j'j}^k)^2$ where $d_{j'j}^k$ is the distance
          between product $j$ and $j'$ in characteristic $k$.
    \item Local: $\sum_{j' \neq j} 1\{d_{j'j}^k < sd^k\}$ where $sd^k$ is the standard
          deviation of $x^k$ acorss all markets.
\end{enumerate}
We select the following instruments in addition to the previous nested logit instruments:\\
\verb|size_local, disp_local, wb_local, hp_local, hp2wt_local|
\subsection{Results}
We plot the GMM objective function w.r.t. $\sigma$ in Figure
\ref{fig:iv_local_diff}.
\begin{figure}[h!]
    \centering
    \includegraphics[width=0.8\textwidth]{../Results/Figures/gmm_obj_iv_local.pdf}
    \caption{GMM objective function w.r.t. $\sigma$}
    \label{fig:iv_local_diff}
\end{figure}
The estimation results by regressing $\delta_j$ on $X_j$ and $p_j$ are shown in Table \ref{tab:reg_rand_coef}.
\begin{table}[h!]\fontsize{10pt}{12pt}\selectfont
    \centering
    \input{../Results/Tables/rand_coef.tex}
    \caption{Random coefficient on size}
    \label{tab:reg_rand_coef}
\end{table}

\section{Question 4+5 : Markups, merger simulation}
\subsection{Price setting equation}
The profit of a multiproduct firm is $$ \Pi_f = \sum_{j\in \mathcal{J}_f} (p_j
    -c_j )s_jM$$ since $s_jM$ represents the sales of the product $j$.

The optimal price is given by taking the first order derivative wrt p.

$$ s_j+\sum_{k\in \mathcal{J}_f} \frac{\partial s_k}{\partial p_j} (p_k-c_k) = 0 \quad \forall j\in \mathcal{J}_f$$

The first term is the direct impact of changing $p_j$. The second term is the
impact on the profits of other products of the firm.

For firm $f$, the pricing equation written in the matrix form gives, $$ S^f +
    \Omega^f(P^f-C^f) = 0$$ where $\Omega^f$ is the matrix of cross-price
elasticities. For example, if firm $f$ has two products, the matrix is $$
    \Omega^f =\begin{bmatrix}
        \frac{\partial s_1}{\partial p_1} & \frac{\partial s_1}{\partial p_2} & 0 \\\ \frac{\partial s_2}{\partial p_1} &\frac{\partial s_2}{\partial p_2} & 0 \\0 & 0 &0\\
    \end{bmatrix}$$

Therefore, aggregate the pricing equation for all firms, we have $$ S + \Omega
    \odot O (P-C) = 0 $$ where $O$ is the ownership matrix.
\subsection{Estimation}
We take $\hat{\alpha}=-0.0785$. We estimate marginal cost (negative), markup
and elasticiy for each year. We simulate a merger between firm17 and firm7, by
modifying the ownership matrix. The mean results are shown in Table
\ref{tab:post_merger_mean}. Table \ref{tab:markup} shows the results.
\input{../Results/Tables/post_merger_mean.tex} The anomaly is that we get
negative marginal cost, this is due to the small $\hat{\alpha}$ from the
estimation. Also, the effect of average price seems to be very insignificant.

We calculate consumer surplus pre and post merger in monetary terms, $$CS_i =
    E(\max_j u_{ij})= \frac{\ln(1+\sum_j \exp(\delta_j+\mu_{ij}))}{\alpha_i}$$
Notice that $$s_0=\frac{1}{1+\sum_j \exp\delta_j+\mu_{ij}}$$ Thus
$$CS_i=\frac{-\ln(s_0)}{\alpha_i}$$ In total, $$ CS = M\int
    CS_i(\theta)dF(\theta)$$

The result is shown in Table \ref{tab:post_merger_cs}
\input{../Results/Tables/post_merger_cs.tex}
\end{document}